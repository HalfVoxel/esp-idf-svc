<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="\brief           Determine valid PSA attributes that can be used to import a key into PSA."><title>mbedtls_pk_get_psa_attributes in esp_idf_svc::sys - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="esp_idf_svc" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0-nightly (35b658fb1 2024-07-08)" data-channel="nightly" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../esp_idf_svc/index.html">esp_idf_svc</a><span class="version">0.49.1</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In esp_idf_svc::sys</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">esp_idf_svc</a>::<wbr><a href="index.html">sys</a>::<wbr><a class="fn" href="#">mbedtls_pk_get_psa_attributes</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/esp_idf_sys/home/runner/work/esp-idf-svc/esp-idf-svc/target/riscv32imc-esp-espidf/debug/build/esp-idf-sys-287a1e06334cf895/out/bindings.rs.html#38494-38498">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub unsafe extern &quot;C&quot; fn mbedtls_pk_get_psa_attributes(
    pk: *const <a class="struct" href="struct.mbedtls_pk_context.html" title="struct esp_idf_svc::sys::mbedtls_pk_context">mbedtls_pk_context</a>,
    usage: u32,
    attributes: *mut <a class="struct" href="struct.psa_key_attributes_s.html" title="struct esp_idf_svc::sys::psa_key_attributes_s">psa_key_attributes_s</a>,
) -&gt; i32</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>\brief           Determine valid PSA attributes that can be used to
import a key into PSA.</p>
<p>The attributes determined by this function are suitable
for calling mbedtls_pk_import_into_psa() to create
a PSA key with the same key material.</p>
<p>The typical flow of operations involving this function is</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>psa_key_attributes_t attributes = PSA_KEY_ATTRIBUTES_INIT;
int ret = mbedtls_pk_get_psa_attributes(pk, <span class="kw-2">&amp;</span>attributes);
<span class="kw">if </span>(ret != <span class="number">0</span>) ...; <span class="comment">// error handling omitted
// Tweak attributes if desired
</span>psa_key_id_t key_id = <span class="number">0</span>;
ret = mbedtls_pk_import_into_psa(pk, <span class="kw-2">&amp;</span>attributes, <span class="kw-2">&amp;</span>key_id);
<span class="kw">if </span>(ret != <span class="number">0</span>) ...; <span class="comment">// error handling omitted</span></code></pre></div>
<p>\note            This function does not support RSA-alt contexts
(set up with mbedtls_pk_setup_rsa_alt()).</p>
<p>\param[in] pk    The PK context to use. It must have been set up.
It can either contain a key pair or just a public key.
\param usage     A single <code>PSA_KEY_USAGE_xxx</code> flag among the following:
- #PSA_KEY_USAGE_DECRYPT: \p pk must contain a
key pair. The output \p attributes will contain a
key pair type, and the usage policy will allow
#PSA_KEY_USAGE_ENCRYPT as well as
#PSA_KEY_USAGE_DECRYPT.
- #PSA_KEY_USAGE_DERIVE: \p pk must contain a
key pair. The output \p attributes will contain a
key pair type.
- #PSA_KEY_USAGE_ENCRYPT: The output
\p attributes will contain a public key type.
- #PSA_KEY_USAGE_SIGN_HASH: \p pk must contain a
key pair. The output \p attributes will contain a
key pair type, and the usage policy will allow
#PSA_KEY_USAGE_VERIFY_HASH as well as
#PSA_KEY_USAGE_SIGN_HASH.
- #PSA_KEY_USAGE_SIGN_MESSAGE: \p pk must contain a
key pair. The output \p attributes will contain a
key pair type, and the usage policy will allow
#PSA_KEY_USAGE_VERIFY_MESSAGE as well as
#PSA_KEY_USAGE_SIGN_MESSAGE.
- #PSA_KEY_USAGE_VERIFY_HASH: The output
\p attributes will contain a public key type.
- #PSA_KEY_USAGE_VERIFY_MESSAGE: The output
\p attributes will contain a public key type.
\param[out] attributes
On success, valid attributes to import the key into PSA.
- The lifetime and key identifier are unchanged. If the
attribute structure was initialized or reset before
calling this function, this will result in a volatile
key. Call psa_set_key_identifier() before or after this
function if you wish to create a persistent key. Call
psa_set_key_lifetime() before or after this function if
you wish to import the key in a secure element.
- The key type and bit-size are determined by the contents
of the PK context. If the PK context contains a key
pair, the key type can be either a key pair type or
the corresponding public key type, depending on
\p usage. If the PK context contains a public key,
the key type is a public key type.
- The key’s policy is determined by the key type and
the \p usage parameter. The usage always allows
\p usage, exporting and copying the key, and
possibly other permissions as documented for the
\p usage parameter.
The permitted algorithm policy is determined as follows
based on the #mbedtls_pk_type_t type of \p pk,
the chosen \p usage and other factors:
- #MBEDTLS_PK_RSA whose underlying
#mbedtls_rsa_context has the padding mode
#MBEDTLS_RSA_PKCS_V15:
#PSA_ALG_RSA_PKCS1V15_SIGN(#PSA_ALG_ANY_HASH)
if \p usage is SIGN/VERIFY, and
#PSA_ALG_RSA_PKCS1V15_CRYPT
if \p usage is ENCRYPT/DECRYPT.
- #MBEDTLS_PK_RSA whose underlying
#mbedtls_rsa_context has the padding mode
#MBEDTLS_RSA_PKCS_V21 and the digest type
corresponding to the PSA algorithm \c hash:
#PSA_ALG_RSA_PSS_ANY_SALT(#PSA_ALG_ANY_HASH)
if \p usage is SIGN/VERIFY, and
#PSA_ALG_RSA_OAEP(\c hash)
if \p usage is ENCRYPT/DECRYPT.
- #MBEDTLS_PK_RSA_ALT: not supported.
- #MBEDTLS_PK_ECDSA or #MBEDTLS_PK_ECKEY
if \p usage is SIGN/VERIFY:
#PSA_ALG_DETERMINISTIC_ECDSA(#PSA_ALG_ANY_HASH)
if #MBEDTLS_ECDSA_DETERMINISTIC is enabled,
otherwise #PSA_ALG_ECDSA(#PSA_ALG_ANY_HASH).
- #MBEDTLS_PK_ECKEY_DH or #MBEDTLS_PK_ECKEY
if \p usage is DERIVE:
#PSA_ALG_ECDH.
- #MBEDTLS_PK_OPAQUE: same as the primary algorithm
set for the underlying PSA key, except that
sign/decrypt flags are removed if the type is
set to a public key type.
The underlying key must allow \p usage.
Note that the enrollment algorithm set with
psa_set_key_enrollment_algorithm() is not copied.</p>
<p>\return          0 on success.
#MBEDTLS_ERR_PK_TYPE_MISMATCH if \p pk does not contain
a key of the type identified in \p attributes.
Another error code on other failures.</p>
</div></details></section></div></main></body></html>